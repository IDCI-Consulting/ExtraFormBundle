export default "{\n    \"name\": \"testtefa_idci_jeu_toto\",\n    \"options\": {\n        \"final_destination\": \"/\"\n    },\n    \"steps\": {\n        \"home\": {\n            \"type\": \"html\",\n            \"options\": {\n                \"title\": \"Comment tenter de remporter une pièce d’or ?\",\n                \"content\": \"<h1 class='Title'>Comment tenter de remporter une pièce d’or ?</h1><p class='text-upper'>Voici les étapes à suivre pour tenter de remporter votre pièce d’or :</p><ul class='help-list'><li>Saisissez le code inscrit sur votre produit broockie® ou idci®</li><li>Téléchargez votre ticket de caisse en veillant à bien entourer les informations suivantes : date d’achat, heure d’achat, produit éligible acheté, prix du produit éligible, montant total TTC de votre ticket de caisse.</li><li>En validant votre toto, vous découvrirez votre gain (sous réserve de la conformité de votre toto)</li></ul><p class='text-small'>Si vous avez reçu un email de notre part suite à une 1ère toto non conforme aux règles de ce jeu, vous devrez uniquement télécharger votre ticket de caisse en veillant à bien entourer les informations suivantes : date d’achat, heure d’achat, produit éligible acheté, prix du produit éligible, montant total TTC de votre ticket de caisse. Votre toto sera de nouveau contrôlée afin de valider votre gain.</p>\",\n                \"attr\": {\n                    \"class\": \"home\"\n                }\n            }\n        },\n        \"code\": {\n            \"type\": \"form\",\n            \"options\": {\n                \"title\": \"J'ai un code idci®\",\n                \"previous_options\": {\n                    \"label\": \"Précédent\",\n                    \"attr\": {\n                        \"class\": \"button back\"\n                    }\n                },\n                \"display_title\": false,\n                \"attr\": {\n                    \"class\": \"code\"\n                },\n                \"@builder\": {\n                    \"worker\": \"extra_form_builder\",\n                    \"parameters\": {\n                        \"configuration\": {\n                            \"usable_code\": {\n                                \"extra_form_type\": \"text\",\n                                \"options\": {\n                                    \"label\": \"Retrouvez votre code unique<br/>au dos de l'emballage (ex: ADYOUOK1N172)\",\n                                    \"max_length\": 12\n                                },\n                                \"constraints\": [\n                                    {\n                                        \"extra_form_constraint\": \"not_blank\",\n                                        \"options\": {\n                                            \"message\": \"Merci de renseigner votre code\"\n                                        }\n                                    },\n                                    {\n                                        \"extra_form_constraint\": \"tms_eligibility_checker\",\n                                        \"options\": {\n                                            \"checkerPath\": \"totolimit\",\n                                            \"parameters\": {\n                                                \"offer\": \"{{ toto.offer.reference }}\",\n                                                \"customer\": \"{{ toto.offer.customer.reference }}\",\n                                                \"user\": \"{{ '{{ user.id }}' }}\",\n                                                \"limit\": \"1\"\n                                            },\n                                            \"parameterKey\": {},\n                                            \"messages\": {\n                                                \"toto\": \"Vous avez déjà participé à l'offre. Cette offre est limitée à 1 toto maximum par personne.\"\n                                            }\n                                        }\n                                    },\n                                    {\n                                        \"extra_form_constraint\": \"tms_eligibility_checker\",\n                                        \"options\": {\n                                            \"checkerPath\": \"usablecode\",\n                                            \"parameters\": {\n                                                \"codespace\": \"testidci-idci\",\n                                                \"offer\": \"{{ toto.offer.id }}\",\n                                                \"limit\": \"1\",\n                                                \"search\": \"usable_code\"\n                                            },\n                                            \"parameterKey\": \"usable_code\",\n                                            \"messages\": {\n                                                \"404\": \"Le code que vous avez saisi est erroné.\",\n                                                \"409\": \"Le code que vous avez saisi a déjà été utilisé.\",\n                                                \"500\": \"Nous sommes désolés mais nous ne pouvons vérifier actuellement la validité du code que vous avez saisi. Veuillez réessayer ultérieurement.\"\n                                            }\n                                        }\n                                    }\n                                ]\n                            }\n                        }\n                    }\n                }\n            },\n            \"events\": {\n                \"form.post_set_data\": [\n                    {\n                        \"name\": \"check_toto\",\n                        \"action\": \"check_toto\",\n                        \"parameters\": {\n                            \"customer\": \"{{ toto.offer.customer.reference }}\",\n                            \"offer\": \"{{ toto.offer.reference }}\",\n                            \"limit\": 1,\n                            \"user\": \"{{ '{{ user.id }}' }}\",\n                            \"modal_title\": \"Votre toto a déjà été enregistrée.\",\n                            \"modal_message\": \"<p>Cette offre est limitée à 1 toto maximum par personne.</p><br /><p>A bientôt pour de prochaines offres exclusives !</p><br /></p>L’équipe test idci</p>\",\n                            \"modal_level\": \"error\",\n                            \"modal_actions\": [\n                                {\n                                    \"name\": \"Ok\",\n                                    \"href\": \"/\",\n                                    \"attr\": {\n                                        \"class\": \"button\"\n                                    }\n                                }\n                            ]\n                        }\n                    }\n                ]\n            }\n        },\n        \"proof\": {\n            \"type\": \"form\",\n            \"options\": {\n                \"title\": \"Merci de télécharger votre<br/> ticket de caisse\",\n                \"previous_options\": {\n                    \"label\": \"Précédent\",\n                    \"attr\": {\n                        \"class\": \"button back back-yt\"\n                    }\n                },\n                \"js\": \"sessionStorage.removeItem('iw-countdown');\",\n                \"display_title\": false,\n                \"data\": {\n                    \"identity_gender\": \"{{ '{{ user.raw.identity_gender|default(\\'\\') }}' }}\",\n                    \"identity_firstName\": \"{{ '{{ user.raw.identity_firstName|default(\\'\\') }}' }}\",\n                    \"identity_lastName\": \"{{ '{{ user.raw.identity_lastName|default(\\'\\') }}' }}\",\n                    \"identity_address1\": \"{{ '{{ user.raw.identity_address1|default(\\'\\') }}' }}\",\n                    \"identity_address2\": \"{{ '{{ user.raw.identity_address2|default(\\'\\') }}' }}\",\n                    \"identity_zipCode\": \"{{ '{{ user.raw.identity_zipCode|default(\\'\\') }}' }}\",\n                    \"identity_city\": \"{{ '{{ user.raw.identity_city|default(\\'\\') }}' }}\",\n                    \"identity_mobilePhone\": \"{{ '{{ user.raw.identity_mobilePhone|default(\\'\\') }}' }}\",\n                    \"identity_email\": \"{{ '{{ user.email|default(\\'\\') }}' }}\"\n                },\n                \"attr\": {\n                    \"class\": \"proof\"\n                },\n                \"@builder\": {\n                    \"worker\": \"extra_form_builder\",\n                    \"parameters\": {\n                        \"configuration\": {\n                            \"help\": {\n                                \"extra_form_type\": \"html\",\n                                \"options\": {\n                                    \"content\": \"<p class='text-upper'>Prenez en photo ou scannez votre ticket de caisse avant de le télécharger ci-dessous dans son intégralité  en veillant à ce que les éléments suivants soient bien lisibles<span class='asterisk'>*</span> :</p><ul class='help-list'><li>Le nom de votre magasin</li><li>La date et l'heure d'achat de votre produit porteur de l'offre</li><li>Le nom du produit porteur de l'offre acheté ainsi que le montant (TTC)</li><li>Le montant total (TTC) de votre ticket de caisse</li></ul><div class='text-small'><p class='text-upper'>Attention :</p><ul class='help-list'><li>Si ces informations ne sont pas visibles, votre toto sera invalide et votre code promo inutilisable à nouveau.</li><li>Si votre ticket de caisse est trop long, pliez-le en accordéon de façon à faire apparaître le haut et le bas du ticket, et vos achats.</li></ul></div>\",\n                                    \"attr\": {\n                                        \"class\": \"help\"\n                                    }\n                                }\n                            },\n                            \"purchase-1_proof-1\": {\n                                \"extra_form_type\": \"tms_media_upload\",\n                                \"constraints\": [\n                                    {\n                                        \"extra_form_constraint\": \"tms_media_upload_not_blank\",\n                                        \"options\": {\n                                            \"message\": \"Merci de télécharger une photo de votre ticket de caisse.\"\n                                        }\n                                    },\n                                    {\n                                        \"extra_form_constraint\": \"tms_media_upload_file\",\n                                        \"options\": {\n                                            \"maxSize\": \"5M\",\n                                            \"maxSizeMessage\": \"Poids incorrect : Le poids de votre fichier dépasse la limite autorisée de 5Mo. Merci de réduire son poids et recommencer.\",\n                                            \"uploadIniSizeErrorMessage\": \"Poids incorrect : Le poids de votre fichier dépasse la limite autorisée de 5Mo. Merci de réduire son poids et recommencer.\",\n                                            \"uploadFormSizeErrorMessage\": \"Poids incorrect : Le poids de votre fichier dépasse la limite autorisée de 5Mo. Merci de réduire son poids et recommencer.\",\n                                            \"mimeTypes\": [\n                                                \"image/png\",\n                                                \"image/jpeg\",\n                                                \"image/gif\",\n                                                \"image/tiff\",\n                                                \"application/pdf\"\n                                            ],\n                                            \"mimeTypesMessage\": \"Format non reconnu : Le format de votre fichier est incorrect. Merci de bien vérifier la liste des formats acceptés.\"\n                                        }\n                                    }\n                                ],\n                                \"options\": {\n                                    \"label\": \" \",\n                                    \"required\": true,\n                                    \"metadata\": {\n                                        \"customer\": \"{{ toto.offer.customer.reference }}\",\n                                        \"offer\": \"{{ toto.offer.reference }}\"\n                                    },\n                                    \"attr\": {\n                                        \"class\": \"proof center\",\n                                        \"placeholder\": \"Ajouter un ticket de caisse|Modifier\"\n                                    }\n                                }\n                            },\n                            \"formats\": {\n                                \"extra_form_type\": \"html\",\n                                \"options\": {\n                                    \"content\": \"<p><strong>JPG, GIF, PNG, PDF ou TIFF <br>Poids maximum : 5Mo</strong></p>\",\n                                    \"attr\": {\n                                        \"class\": \"formats\"\n                                    }\n                                }\n                            },\n                            \"use-twice\": {\n                                \"extra_form_type\": \"html\",\n                                \"options\": {\n                                    \"content\": \"<p class='text-small'>Si votre ticket de caisse comprend un produit idci<span class='asterisk'>®</span> porteur de l’offre &amp; un produit broockie<span class='asterisk'>®</span> porteur de l’offre, vous pouvez l’utiliser une seconde fois.</p>\",\n                                    \"attr\": {\n                                        \"class\": \"\"\n                                    }\n                                }\n                            },\n                            \"mandatory\": {\n                                \"extra_form_type\": \"html\",\n                                \"options\": {\n                                    \"content\": \"<p class='text-small'><span class='asterisk'>*</span> champs obligatoires</p>\"\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        },\n        \"result\": {\n            \"type\": \"html\",\n            \"options\": {\n                \"prevent_previous\": true,\n                \"js\": \"if (! sessionStorage.getItem('iw-countdown')) { $('body.offerParticipate form').addClass('countdown'); sessionStorage.setItem('iw-countdown', true); var countdown = function(){var $number = $countdown.find('.number'); $number.data('value', $number.data('value') - 1); $number.text($number.data('value')); if ($number.data('value')) { setTimeout(countdown, 1000); } else { $('body.offerParticipate .step-result, body.offerParticipate form').removeClass('countdown').addClass('{{ '{{ flow_data.retrievedData.code.retrieved_instant_win_benefit.benefits.0|default(false) ? \\'win\\' : \\'lost\\' }}' }}'); } }; var $countdown = $('body.offerParticipate form .countdown'); setTimeout(countdown, 1000); } else { $('body.offerParticipate .step-result, body.offerParticipate form').addClass('{{ '{{ flow_data.retrievedData.code.retrieved_instant_win_benefit.benefits.0|default(0) ? \\'win\\' : \\'lost\\' }}' }}'); } var axel = Math.random() + '';var a = axel * 10000000000000;document.write('<iframe src=\\\"https://4711614.fls.doubleclick.net/activityi;src=4711614;type=idcifr1;cat=idci00-;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;ord=' + a + '?\\\" width=\\\"1\\\" height=\\\"1\\\" frameborder=\\\"0\\\" style=\\\"display:none\\\"></iframe>');\",\n                \"css\": \" body.offerParticipate form.countdown .button { display: none; } body.offerParticipate form.lost .countdown, body.offerParticipate form.win .countdown { display: none; } body.offerParticipate form .countdown { display: block; } body.offerParticipate form.lost .result, body.offerParticipate form.win .result { display: block; } body.offerParticipate form .result { display: none; } body.offerParticipate form.win .result .button { display: block; }\",\n                \"content\": \"<div class='countdown'><h1 class='Title'>Dans quelques instants découvrirez si vous avez gagné une pièce d'or…</h1><p>Surtout ne fermez pas votre navigateur…</p><p class='number' data-value='4'>4</p></div><div class='result'>{{ '{% if flow_data.retrievedData.code.retrieved_instant_win_benefit.benefits.0|default(0) %}<h1 class=\\'Title\\'>Bravo, vous remportez une pièce d’or</h1><p>Vous gagnez une pièce d’or d’une valeur de 116€*, sous réserve de la validation de votre ticket de caisse par nos équipes. <br/>Si votre toto est traitée conforme, vous recevrez votre pièce d’or dans un délai de 4 à 6 semaines à l’adresse indiquée lors de votre inscription.</p><p>Vous gagnez également le remboursement de votre prochain pot de broockie®.</p><p class=\\'text-small text-italic\\'>* Montant d’une pièce Napoléon 10 Francs en or en date du 23/12/2016, susceptible d’évoluer</p>{% else %}<h1 class=\\'Title\\'>Vous avez perdu…</h1><p>Désolé, vous n’avez pas gagné votre pièce d’or, mais vous gagnez le remboursement de votre pot de broockie®, sous réserve de la validation de votre ticket de caisse par nos équipes.</p><p>Vous pouvez encore tenter votre chance et gagner avec un code broockie®{% endif %}' }}</div> <noscript><iframe src='https://4711614.fls.doubleclick.net/activityi;src=4711614;type=idcifr1;cat=idci00-;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;ord=1?' width='1' height='1' frameborder='0' style='display:none'></iframe></noscript><a class='previous button yellow' href= '/offers/2670/participate/0?reset=1'>Je tente ma chance avec mon code broockie®</a><a class='previous button yellow' href= '/content/howitworks'>Comment profiter de mon offre de remboursement ?</a>\",\n                \"attr\": {\n                    \"class\": \"\"\n                }\n            }\n        },\n        \"test_condition\": {\n            \"type\": \"html\",\n            \"options\": {}\n        }\n    },\n    \"paths\": [\n        {\n            \"type\": \"conditional_destination\",\n            \"options\": {\n                \"source\": \"home\",\n                \"destinations\": {\n                    \"proof\": \"{{ '{{ flow_data.retrievedData.proof.created_toto.id|default(false) ? 1 : 0 }}' }}\"\n                },\n                \"default_destination\": \"code\",\n                \"next_options\": {\n                    \"label\": \"Continuer ma toto\",\n                    \"attr\": {\n                        \"class\": \"next button yellow\"\n                    }\n                }\n            }\n        },\n        {\n            \"type\": \"single\",\n            \"options\": {\n                \"source\": \"code\",\n                \"destination\": \"proof\",\n                \"next_options\": {\n                    \"label\": \"Valider\",\n                    \"attr\": {\n                        \"class\": \"next button redy\"\n                    }\n                },\n                \"events\": {\n                    \"form.post_bind\": [\n                        {\n                            \"action\": \"retrieve_benefit\",\n                            \"name\": \"retrieved_offer_benefit\",\n                            \"parameters\": {\n                                \"customer\": \"{{ toto.offer.customer.id }}\",\n                                \"offer\": \"{{ toto.offer.id }}\"\n                            }\n                        },\n                        {\n                            \"action\": \"retrieve_benefit\",\n                            \"name\": \"retrieved_code_benefit\",\n                            \"parameters\": {\n                                \"codespace\": \"testidci-idci\",\n                                \"code\": \"{{ '{{ flow_data.data.code.usable_code }}' }}\"\n                            }\n                        },\n                        {\n                            \"action\": \"retrieve_benefit\",\n                            \"name\": \"retrieved_instant_win_benefit\",\n                            \"parameters\": {\n                                \"namespace\": \"testidci_idci\",\n                                \"context\": \"{{ '{{ {identity_email: user.email|default(\\'\\'), usable_code: flow_data.data.code.usable_code }|json_encode|trim(\\'\\\\\"\\')|raw }}' }}\",\n                                \"options\": {}\n                            }\n                        }\n                    ]\n                }\n            }\n        },\n        {\n            \"type\": \"single\",\n            \"options\": {\n                \"source\": \"proof\",\n                \"destination\": \"result\",\n                \"next_options\": {\n                    \"label\": \"Valider\",\n                    \"attr\": {\n                        \"class\": \"next button yellow\"\n                    }\n                },\n                \"events\": {\n                    \"form.post_bind\": [\n                        {\n                            \"action\": \"create_toto\",\n                            \"name\": \"created_toto\",\n                            \"parameters\": {\n                                \"customer\": \"{{ toto.offer.customer.reference }}\",\n                                \"offer\": \"{{ toto.offer.reference }}\",\n                                \"operation\": \"{{ toto.offer.operation.reference }}\",\n                                \"processing_state\": \"Synchronous\",\n                                \"source\": \"digifid - webConsumerApp - test-idci.odr.fr\",\n                                \"raw_benefit\": \"{{ '{% set raw_benefit = flow_data.retrievedData.code.retrieved_offer_benefit %}{% if flow_data.retrievedData.code.retrieved_instant_win_benefit.benefits.0|default(0) %}{% set raw_benefit = {\\\\\"benefits\\\\\" :[raw_benefit.benefits.0, flow_data.retrievedData.code.retrieved_instant_win_benefit.benefits.0],\\\\\"history\\\\\" :[raw_benefit.history.0, flow_data.retrievedData.code.retrieved_instant_win_benefit.history.0]} %}{% endif %}{{ raw_benefit|json_encode|trim(\\'\\\\\"\\')|raw }}' }}\"\n                            }\n                        },\n                        {\n                            \"action\": \"allow_redo_toto\",\n                            \"parameters\": {\n                                \"toto_id\": \"{{ '{{ flow_data.retrievedData.proof.created_toto.id }}' }}\"\n                            }\n                        },\n                        {\n                            \"action\": \"process_eligibility\",\n                            \"parameters\": {\n                                \"customer\": \"{{ toto.offer.customer.reference }}\",\n                                \"toto_id\": \"{{ '{{ flow_data.retrievedData.proof.created_toto.id }}' }}\"\n                            }\n                        },\n                        {\n                            \"action\": \"create_order\",\n                            \"name\": \"created_order\",\n                            \"parameters\": {\n                                \"logical_expression\": \"{{ '{% if flow_data.retrievedData.code.retrieved_instant_win_benefit.benefits.0|default(0) %}1{% else %}0{% endif%}' }}\",\n                                \"benefit_id\": \"{{ '{{ flow_data.retrievedData.code.retrieved_offer_benefit.benefits.0.raw.benefitId|default(false) }}' }}\",\n                                \"operation\": \"{{ toto.offer.operation.reference }}\",\n                                \"toto\": \"{{ '{{ flow_data.retrievedData.proof.created_toto.id }}' }}\"\n                            }\n                        },\n                        {\n                            \"action\": \"confirm_order\",\n                            \"name\": \"confirm_order\",\n                            \"parameters\": {\n                                \"logical_expression\": \"{{ '{% if flow_data.retrievedData.code.retrieved_instant_win_benefit.benefits.0|default(0) %}1{% else %}0{% endif%}' }}\",\n                                \"order_id\": \"{{ '{{ flow_data.retrievedData.proof.created_order.id }}' }}\"\n                            }\n                        },\n                        {\n                            \"action\": \"retrieve_document\",\n                            \"name\": \"retrieved_document\",\n                            \"parameters\": {\n                                \"document_id\": \"test-idci-confirmation-toto-idci\",\n                                \"mode\": \"content\",\n                                \"data\": {\n                                    \"toto\": \"{{ '{{ flow_data.retrievedData.proof.created_toto.id|default(null) }}' }}\",\n                                    \"offer\": \"{{ toto.offer.id }}\"\n                                },\n                                \"options\": {\n                                    \"format\": \"html\"\n                                }\n                            }\n                        },\n                        {\n                            \"action\": \"notify\",\n                            \"name\": \"notify_welcome\",\n                            \"parameters\": {\n                                \"type\": \"email\",\n                                \"options\": {\n                                    \"notifierAlias\": \"testidci\",\n                                    \"to\": \"{{ '{{ flow_data.data.proof.identity_email }}' }}\",\n                                    \"subject\": \"Confirmation de votre toto avec votre code idci® sur www.broockie-idci.com\",\n                                    \"htmlMessage\": \"{{ '{{ flow_data.retrievedData.proof.retrieved_document|raw }}' }}\"\n                                }\n                            }\n                        }\n                    ]\n                }\n            }\n        },\n        {\n            \"type\": \"end\",\n            \"options\": {\n                \"source\": \"result\",\n                \"next_options\": {\n                    \"label\": \" \"\n                }\n            }\n        },\n        {\n            \"type\": \"conditional_destination\",\n            \"options\": {\n                \"source\": \"home\",\n                \"destinations\": [\n                    {\n                        \"step\": \"test_condition\",\n                        \"condition\": \"retrieved_code dededeed\"\n                    }\n                ],\n                \"default_destination\": \"proof\"\n            }\n        }\n    ],\n    \"graphPositions\": {\n        \"steps\": {\n            \"home\": {\n                \"x\": 148,\n                \"y\": 28\n            },\n            \"code\": {\n                \"x\": 154,\n                \"y\": 330\n            },\n            \"proof\": {\n                \"x\": 411,\n                \"y\": 339\n            },\n            \"result\": {\n                \"x\": 412,\n                \"y\": 483\n            },\n            \"test_condition\": {\n                \"x\": 676,\n                \"y\": 111\n            }\n        },\n        \"paths\": [\n            {\n                \"intersection\": {\n                    \"x\": 214,\n                    \"y\": 183\n                }\n            },\n            {},\n            {},\n            {\n                \"endOfPath\": {\n                    \"x\": 162,\n                    \"y\": 475\n                }\n            },\n            {\n                \"intersection\": {\n                    \"x\": 365,\n                    \"y\": 48\n                },\n                \"vertices\": [],\n                \"intersectionToDestination0\": [\n                    {\n                        \"x\": 599,\n                        \"y\": 107\n                    }\n                ],\n                \"intersectionToDefaultDestination\": [\n                    {\n                        \"x\": 332,\n                        \"y\": 191\n                    },\n                    {\n                        \"x\": 659,\n                        \"y\": 318\n                    }\n                ]\n            }\n        ]\n    }\n}";
